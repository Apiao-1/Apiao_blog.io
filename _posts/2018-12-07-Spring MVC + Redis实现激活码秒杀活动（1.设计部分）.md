---
layout: post
title: Spring MVC + Redis实现激活码秒杀活动（1.设计部分）
categories: blog
date: 2018-12-07
tags: [技术类]
description: "网易实习的第二个项目，激活码秒杀活动后台记录"
header-img: "img/article3.jpg"
---

# 激活码秒杀（设计部分）

## 抢码流程图

![在这里插入图片描述](https://apiao-1258505467.cos.ap-chengdu.myqcloud.com/blog_pic/seckill/seckill_flowChat.png)
![在这里插入图片描述](https://apiao-1258505467.cos.ap-chengdu.myqcloud.com/blog_pic/seckill/seckill_function.png)

以上是秒杀活动主要的流程图及要实现的功能的交互稿。PS：这里之所以把白名单和普通名单分成两个码库是为了体现白名单用户在抢码时优先于普通用库（因为参与竞争的人少，白名单用户有更大几率能秒杀成功自己码库的激活码）

#### 争议点：
- 统计接口是按照参与人次统计还是按照用户账号统计，举例说明：按参与人次则同一个账号抢5次数据库会记录5次，而按账号则只统计一次（后明确按账号统计）；
-  非抢码时间参与抢码的用户是否需要进行统计，若需要则其场次信息处理方式？
-  黑名单用户重复抢码的返回状态是“重复抢码”还是“黑名单用户无法抢码”，对该类问题统一意见即可
- 激活码抢完之后，返回状态是“本场码已发完”或是“不在抢码时间内”，对该类问题统一意见即可

#### 良好的可扩展性、可配置性：
- **抢码成功应同时记录抢码时间与场次信息，方便以后需求的扩充**
- 每一场的场次时间、码数、持续时间数均要可配置
- redis相关的初始化信息统一写入同一个.conf配置文件

#### 难点
- 高并发场景兼顾并发控制后的性能
- 定时器的正确使用（考虑分布式）
- 优化，追求性能

#### 实现
- redis加分布式锁
- 不进行加锁，通过原子操作模拟锁行为，加大并发

具体实现见下文
